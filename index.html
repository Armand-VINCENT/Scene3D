<html>
  <head>
    <title>Scene 3D</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene fog="type: exponential; color: #121345; density: 0.2">
      <a-entity scale="3 3 3" position="-0.267 0 -2.00316">
        <a-entity
          gltf-model="assets/VineTree.glb"
          position="0 0.5 0"
          scale="1 1 1"
        ></a-entity>
        <a-entity
          gltf-model="assets/VineTree.glb"
          position="0.71878 0.348 0.74166"
        ></a-entity>

        <a-entity
          gltf-model="assets/VineTree.glb"
          position="1.30447 0.348 -0.32304"
          rotation="0 270 0"
          scale="1.5 1.5 1.5"
        ></a-entity>

        <a-entity
          gltf-model="assets/Grass.glb"
          position="0.4948 -0.03051 -0.43833"
          scale="0.1 0.1 0.1"
        ></a-entity>

        <a-entity
          gltf-model="assets/Campfire.glb"
          position="1.10642 0.06172 0.14578"
          scale="0.1 0.1 0.23"
        >
          <a-light
            type="point"
            color="#FFA500"
            intensity="2"
            distance="4"
            position="0 0.3 0"
          ></a-light>
        </a-entity>

        <a-entity
          gltf-model="assets/PlantBig.glb"
          position="0.07371 -0.00392 0.67879"
          scale="0.25 0.25 0.25"
        >
          <a-light
            type="point"
            color="#687AE6"
            intensity="1"
            distance="5"
            position="0 1 0"
          ></a-light>
        </a-entity>

        <a-entity
          gltf-model="assets/SmallTable.glb"
          position="0.50393 -0.01283 0.20586"
          scale="0.25 0.35 0.25"
        ></a-entity>

        <a-entity
          gltf-model="assets/DoorStraight.glb"
          position="0.02101 0 4"
          rotation="0 180 0"
        >
          <a-light
            type="point"
            color="#FFD700"
            intensity="0.5"
            distance="1"
            position="0 0.38461 0.05076"
            light="decay: 13.18; distance: 2.71; intensity: 6.84"
          ></a-light>
        </a-entity>

        <a-entity
          gltf-model="assets/Computer.glb"
          position="0.49206 0.27289 0.17489"
          scale="0.0025 0.0025 0.0025"
          rotation="0 220 0"
        >
          <a-light
            id="blinkingLight"
            type="point"
            color="#00FF00"
            intensity="1.5"
            distance="0.3"
            position="34.68434 43.45413 0.51209"
            light="decay: 1.34; distance: 0.51"
            animation="property: light.intensity; from: 1.5; to: 0; dir: alternate; dur: 100; loop: true; easing: linear"
          ></a-light>
        </a-entity>
      </a-entity>

      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="30"
        height="30"
        color="#3B5323"
      ></a-plane>

      <a-sky color="#121345"></a-sky>

      <a-camera position="0 1 5"></a-camera>

      <!-- Boîte rouge qui deviendra bleue quand on appuie sur la gâchette -->
      <a-box
        id="toggleBox"
        position="0 1.5 -2"
        depth="0.2"
        height="0.5"
        width="0.5"
        color="#FF0000"
      ></a-box>

      <!-- Deux manettes (gauche/droite) avec laser et super-hands pour saisir/interagir -->
      <a-entity
        id="leftHand"
        laser-controls="hand: left"
        super-hands
      ></a-entity>
      <a-entity
        id="rightHand"
        laser-controls="hand: right"
        super-hands
      ></a-entity>
    </a-scene>

    <script>
      /* Component that toggles the color of #toggleBox on controller trigger or click */
      AFRAME.registerComponent("controller-toggle-box", {
        init: function () {
          const sceneEl = this.el.sceneEl || document.querySelector("a-scene");
          const box = sceneEl.querySelector("#toggleBox");

          if (!box) {
            console.warn("controller-toggle-box: #toggleBox not found");
            return;
          }

          const toggleColor = (el) => {
            const current = (el.getAttribute("color") || "").toLowerCase();
            const isRed = current === "#ff0000" || current === "red";
            el.setAttribute("color", isRed ? "#0000FF" : "#FF0000");
          };

          // Controller trigger: check controller raycaster intersections
          sceneEl.addEventListener("triggerdown", (evt) => {
            const controller = evt.target;
            if (
              !controller ||
              !controller.components ||
              !controller.components.raycaster
            )
              return;
            const intersections = controller.components.raycaster.intersections;
            if (!intersections || !intersections.length) return;
            const hitEl = intersections[0].object.el;
            if (hitEl && hitEl.id === "toggleBox") {
              toggleColor(hitEl);
            }
          });

          // Also support clicking the box directly (desktop cursor/laser click)
          box.addEventListener("click", () => toggleColor(box));
        },
      });

      // Attach component to the scene once DOM ready
      document.addEventListener("DOMContentLoaded", () => {
        const scene = document.querySelector("a-scene");
        if (scene) scene.setAttribute("controller-toggle-box", "");
      });
    </script>
  </body>
</html>
